ALTER TABLE CARTORIO ADD CODNACIONAL INTEGER;

CREATE TABLE GRUPODESPESAS (
  CODIGO INTEGER NOT NULL,
  NOME VARCHAR(100) NOT NULL,
  STATUS SMALLINT DEFAULT 0,
  CARNELEAO INTEGER);
  
  ALTER TABLE GRUPODESPESAS ADD PRIMARY KEY (CODIGO);
  CREATE GENERATOR GGRUPODESPESAS;
  SET GENERATOR GGRUPODESPESAS TO 0;
  
  CREATE TRIGGER BI_GRUPODESPESAS_CODIGO FOR GRUPODESPESAS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO = 0) THEN
      NEW.CODIGO = GEN_ID(GGRUPODESPESAS, 1);
END;

CREATE TABLE SUBGRUPODESPESAS (
  CODIGO INTEGER NOT NULL,
  GRUPODESPESAS INTEGER NOT NULL,
  NOME VARCHAR(100) NOT NULL);
  
  ALTER TABLE SUBGRUPODESPESAS ADD PRIMARY KEY (CODIGO);
  CREATE GENERATOR GSUBGRUPODESPESAS;
  SET GENERATOR GSUBGRUPODESPESAS TO 0;
  CREATE TRIGGER TR_SUBGRUPODESPESAS FOR SUBGRUPODESPESAS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO = 0) THEN
      NEW.CODIGO = GEN_ID(GSUBGRUPODESPESAS, 1);
END;

DROP VIEW VCAIXABOLINDIVIDUAL;

CREATE VIEW VCAIXABOLINDIVIDUAL(
  CODCLIENTE,
  CLIENTE,
  DATAATO,
  CODLEI,
  NUMATO,
  NUMLIVRO,
  NUMFOLHA,
  SELO,
  VLREMOLUMENTOS,
  VLRFERJ,
  RECEITASFERJ,
  VLRFERC,
  TIPOATO)
AS
SELECT
LANCBOLEINDIVIDUAL.CLIENTE AS CODCLIENTE,
REGISTROCIVIL.NOME AS CLIENTE,
LANCBOLEINDIVIDUAL.DATAATO,
LANCBOLEINDIVIDUAL.CODLEI,
LANCBOLEINDIVIDUAL.NUMATO,
LANCBOLEINDIVIDUAL.NUMLIVRO,
LANCBOLEINDIVIDUAL.NUMFOLHA,
LANCBOLEINDIVIDUAL.SELO,
LANCBOLEINDIVIDUAL.VLREMOLUMENTOS,
LANCBOLEINDIVIDUAL.VLRFERJ,
LANCBOLEINDIVIDUAL.VLREMOLUMENTOS - LANCBOLEINDIVIDUAL.VLRFERJ AS RECEITASFERJ,
LANCBOLEINDIVIDUAL.VLRFERC,
EMOLUMENTOS.TIPOATO
FROM LANCBOLEINDIVIDUAL
LEFT OUTER JOIN REGISTROCIVIL ON (REGISTROCIVIL.CODIGO = LANCBOLEINDIVIDUAL.CLIENTE)
LEFT OUTER JOIN EMOLUMENTOS ON (EMOLUMENTOS.CODIGO = LANCBOLEINDIVIDUAL.EMOLUMENTO)
;

ALTER TABLE LANCBOLETIMTOTAL ADD DATAATO DATE DEFAULT CURRENT_DATE;

CREATE VIEW VCAIXABOLETIMTOTAL(
  DATAATO,
  CODLEI,
  SELOINI,
  SELOFIM,
  EMOLUNIDADE,
  VLRFERJ,
  RECEITASFERJ,
  VLRFERC,
  TIPOATO)
AS
SELECT
LANCBOLETIMTOTAL.DATAATO,
LANCBOLETIMTOTAL.CODLEI,
LANCBOLETIMTOTAL.SELOINI,
LANCBOLETIMTOTAL.SELOFIM,
LANCBOLETIMTOTAL.EMOLUNIDADE * LANCBOLETIMTOTAL.QUANTIDADE AS EMOLUNIDADE,
LANCBOLETIMTOTAL.VLRFERJ,
(LANCBOLETIMTOTAL.EMOLUNIDADE * LANCBOLETIMTOTAL.QUANTIDADE) - LANCBOLETIMTOTAL.VLRFERJ AS RECEITASFERJ,
LANCBOLETIMTOTAL.VLRFERC,
EMOLUMENTOS.TIPOATO
FROM LANCBOLETIMTOTAL
LEFT OUTER JOIN EMOLUMENTOS ON (EMOLUMENTOS.CODIGO = LANCBOLETIMTOTAL.EMOLUMENTO)
;

CREATE TABLE LANCDESPESAS (
  CODIGO INTEGER NOT NULL,
  SUBGRUPODESPSA INTEGER NOT NULL,
  VALOR NUMERIC(12, 2) DEFAULT 0,
  DESCRICAO VARCHAR(500),
  DATA DATE DEFAULT CURRENT_DATE);
  
  ALTER TABLE LANCDESPESAS ADD PRIMARY KEY (CODIGO);
  CREATE GENERATOR GLANCDESPESAS;
  SET GENERATOR GLANCDESPESAS TO 0;
  CREATE TRIGGER TR_LANCDESPESAS FOR LANCDESPESAS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  IF (NEW.CODIGO = 0) THEN
      NEW.CODIGO = GEN_ID(GLANCDESPESAS, 1);
END;

CREATE VIEW VSUBGRUPODESPESAS(
  CODIGO,
  NOME,
  CODGRUPO,
  GRUPO,
  CARNELEAO)
AS
SELECT
SUBGRUPODESPESAS.CODIGO,
SUBGRUPODESPESAS.NOME,
SUBGRUPODESPESAS.GRUPODESPESAS AS CODGRUPO,
GRUPODESPESAS.NOME AS GRUPO,
GRUPODESPESAS.CARNELEAO
FROM SUBGRUPODESPESAS
INNER JOIN GRUPODESPESAS ON (GRUPODESPESAS.CODIGO = SUBGRUPODESPESAS.GRUPODESPESAS)
;

ALTER TABLE SUBGRUPODESPESAS ADD CONSTRAINT FK_SUBGRUPODESPESAS FOREIGN KEY (GRUPODESPESAS) REFERENCES GRUPODESPESAS(CODIGO);
ALTER TABLE LANCDESPESAS ADD CONSTRAINT FK_LANCDESPESAS FOREIGN KEY (SUBGRUPODESPSA) REFERENCES SUBGRUPODESPESAS(CODIGO);

CREATE VIEW VLANCDESPESAS(
  CODIGO,
  DATA,
  DESCRICAO,
  CODSUBGRUPODESPSA,
  SUBGRUPODESPSA,
  VALOR,
  CODGRUPODESPESA,
  GRUPODESPESA,
  CARNELEAO)
AS
SELECT
LANCDESPESAS.CODIGO,
LANCDESPESAS.DATA,
LANCDESPESAS.DESCRICAO,
LANCDESPESAS.SUBGRUPODESPSA AS CODSUBGRUPODESPSA,
SUBGRUPODESPESAS.NOME AS SUBGRUPODESPSA,
LANCDESPESAS.VALOR,
GRUPODESPESAS.CODIGO AS CODGRUPODESPESA,
GRUPODESPESAS.NOME AS GRUPODESPESA,
GRUPODESPESAS.CARNELEAO
FROM LANCDESPESAS
INNER JOIN SUBGRUPODESPESAS ON (SUBGRUPODESPESAS.CODIGO = LANCDESPESAS.SUBGRUPODESPSA)
INNER JOIN GRUPODESPESAS ON (GRUPODESPESAS.CODIGO = SUBGRUPODESPESAS.GRUPODESPESAS)
;