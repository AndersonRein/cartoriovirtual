ALTER TABLE INTIMACAO ADD DATAPROTESTO DATE;

DROP VIEW VINTIMACAO;

CREATE VIEW VINTIMACAO(
  CODIGO,
  CODACEITE,
  ACEITE,
  CONCLUSAO,
  DATA,
  PROTESTO,
  COD_APRESENTANTE,
  APRESENTANTE,
  CPF_CNPJ_APRESENTANTE,
  END_APRESENTANTE,
  NUM_APRESENTANTE,
  BAIRRO_APRESENTANTE,
  COD_CIDADE_APRESENTANTE,
  CIDADE_APRESENTANTE,
  UF_APRESENTANTE,
  COD_DEVEDOR,
  DEVEDOR,
  CPF_CNPJ_DEVEDOR,
  END_DEVEDOR,
  NUM_DEVEDOR,
  BAIRRO_DEVEDOR,
  COD_CIDADE_DEVEDOR,
  CIDADE_DEVEDOR,
  UF_DEVEDOR,
  PROTOCOLO,
  SEQPROTOCOLO,
  SELO1,
  SELO2,
  CODSTATUS,
  STATUS,
  VALORPROTESTO,
  VENCIMENTO,
  NUMTITULO,
  TITULO,
  TIPOCUMPRIMENTO,
  DATAPROTESTO)
AS
SELECT
INTIMACAO.CODIGO,
INTIMACAO.ACEITE AS CODACEITE,
CASE INTIMACAO.ACEITE WHEN 0 THEN 'SIM'
                      WHEN 1 THEN 'NAO' END AS ACEITE,
INTIMACAO.CONCLUSAO,
INTIMACAO.DATA,
INTIMACAO.PROTESTO,
(SELECT REGISTROCIVIL.CODIGO FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.APRESENTANTE) AS COD_APRESENTANTE,
(SELECT REGISTROCIVIL.NOME FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.APRESENTANTE) AS APRESENTANTE,
(SELECT REGISTROCIVIL.CPF_CNPJ FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.APRESENTANTE) AS CPF_CNPJ_APRESENTANTE,
(SELECT REGISTROCIVIL.ENDERECO FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.APRESENTANTE) AS END_APRESENTANTE,
(SELECT REGISTROCIVIL.NUMERO FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.APRESENTANTE) AS NUM_APRESENTANTE,
(SELECT REGISTROCIVIL.BAIRRO FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.APRESENTANTE) AS BAIRRO_APRESENTANTE,
(SELECT REGISTROCIVIL.CIDADE FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.APRESENTANTE) AS COD_CIDADE_APRESENTANTE,
(SELECT CIDADE.NOME FROM CIDADE INNER JOIN REGISTROCIVIL ON (REGISTROCIVIL.CIDADE = CIDADE.CODIGO AND REGISTROCIVIL.CODIGO = CADPROTESTO.APRESENTANTE)) AS CIDADE_APRESENTANTE,
(SELECT CIDADE.UF FROM CIDADE INNER JOIN REGISTROCIVIL ON (REGISTROCIVIL.CIDADE = CIDADE.CODIGO AND REGISTROCIVIL.CODIGO = CADPROTESTO.APRESENTANTE)) AS UF_APRESENTANTE,
(SELECT REGISTROCIVIL.CODIGO FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.DEVEDOR) AS COD_DEVEDOR,
(SELECT REGISTROCIVIL.NOME FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.DEVEDOR) AS DEVEDOR,
(SELECT REGISTROCIVIL.CPF_CNPJ FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.DEVEDOR) AS CPF_CNPJ_DEVEDOR,
(SELECT REGISTROCIVIL.ENDERECO FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.DEVEDOR) AS END_DEVEDOR,
(SELECT REGISTROCIVIL.NUMERO FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.DEVEDOR) AS NUM_DEVEDOR,
(SELECT REGISTROCIVIL.BAIRRO FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.DEVEDOR) AS BAIRRO_DEVEDOR,
(SELECT REGISTROCIVIL.CIDADE FROM REGISTROCIVIL WHERE REGISTROCIVIL.CODIGO = CADPROTESTO.DEVEDOR) AS COD_CIDADE_DEVEDOR,
(SELECT CIDADE.NOME FROM CIDADE INNER JOIN REGISTROCIVIL ON (REGISTROCIVIL.CIDADE = CIDADE.CODIGO AND REGISTROCIVIL.CODIGO = CADPROTESTO.APRESENTANTE)) AS CIDADE_DEVEDOR,
(SELECT CIDADE.UF FROM CIDADE INNER JOIN REGISTROCIVIL ON (REGISTROCIVIL.CIDADE = CIDADE.CODIGO AND REGISTROCIVIL.CODIGO = CADPROTESTO.APRESENTANTE)) AS UF_DEVEDOR,
INTIMACAO.PROTOCOLO,
PROTOCOLO.SEQ AS SEQPROTOCOLO,
INTIMACAO.SELO1,
INTIMACAO.SELO2,
INTIMACAO.STATUS AS CODSTATUS,
CASE INTIMACAO.STATUS WHEN 0 THEN 'ATIVO'
                      WHEN 1 THEN 'CENCELADO' END AS STATUS,
CADPROTESTO.VALORPROTESTO,
CADPROTESTO.VENCIMENTO,
CADPROTESTO.NUMTITULO,
TITULOS.NOME AS TITULO,
INTIMACAO.TIPOCUMPRIMENTO,
INTIMACAO.DATAPROTESTO
FROM INTIMACAO
INNER JOIN CADPROTESTO ON (CADPROTESTO.CODIGO = INTIMACAO.PROTESTO)
LEFT OUTER JOIN PROTOCOLO ON (PROTOCOLO.CODIGO = INTIMACAO.PROTOCOLO)
LEFT OUTER JOIN TITULOS ON (TITULOS.CODIGO = CADPROTESTO.TITULO)
;